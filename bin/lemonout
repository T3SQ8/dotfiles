#!/bin/sh

Clock() {
	date "+%b %d %H:%M"
}

Battery() {
	grep -q "Charging" /sys/class/power_supply/BAT*/status && status="+"
	echo "BAT:${status}$(cat /sys/class/power_supply/BAT*/capacity)%"
}

Internet() {
	grep -q "up" /sys/class/net/*/operstate && echo "INT: ON" || echo "INT: OFF"
}

Desktop() {
	bspc query -D -d --names
}

Volume() {
	echo "VOL: $(amixer get Master | grep -oE '[0-9]{1,3}%')"
}

Hidden() {
	if bspc query -N -n .hidden.local > /dev/null; then
		for i in $(bspc query -N -n .hidden.local.leaf); do
			hidden="${hidden}+"
		done
		echo " $hidden"
	fi
}

while read -r line; do
	echo "%{+u}%{l} $(Desktop)$(Hidden) %{c}$(Clock)%{r}$(Volume)%{-u} %{+u}$(Internet)%{-u} %{+u}$(Battery) "
done
