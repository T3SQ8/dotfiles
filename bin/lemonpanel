#!/bin/sh

PANEL_FIFO=/tmp/panel-fifo

pgrep -x lemonbar > /dev/null && printf "%s\n" "The panel is already running." && exit 1

[ -e "$PANEL_FIFO" ] && rm "$PANEL_FIFO"
mkfifo "$PANEL_FIFO"

bspc subscribe report > "$PANEL_FIFO" &

lemonout < "$PANEL_FIFO" | lemonbar \
	-u 2 \
	-U "$(xgetres color1)" \
	-f "consolas:size=10" \
	-B "$([ "$(cat /sys/class/power_supply/BAT*/capacity)" -le 15 ] && \
	[ "$(cat /sys/class/power_supply/BAT*/status)" = "Discharging" ] && \
	echo "#ff0000" || xgetres color0)" \
	-F "$(xgetres foreground)" \
	-o 1 | sh &

while true; do
	refpanel
	sleep 10
done
