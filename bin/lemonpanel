#!/bin/sh

Battery_capacity=$(cat /sys/class/power_supply/BAT*/capacity)
Battery_status=$(cat /sys/class/power_supply/BAT*/status)

Clock() {
	date "+%b %d %H:%M"
}

Battery() {
	[ "$Battery_status" = "Charging" ] && Charging_status=+
	echo "BAT:"$Charging_status""$Battery_capacity"%"
}

Internet() {
	cat /sys/class/net/*/operstate | grep -q up && echo "INT: ON" || echo "INT: OFF"
}

Desktop() {
	bspc query -D -d --names
}

Volume() {
	echo "VOL: $(amixer get Master | awk -F"[][]" '/dB/ { print $2 }')"
}

Hidden() {
	if [ $(bspc query -N -n .hidden --desktop | head -n 1) ]; then
		echo " +"
	fi
}

Output() {
	while true; do
		echo "%{+u}%{l} $(Desktop)$(Hidden) %{c}$(Clock)%{r}$(Volume) | $(Internet) | $(Battery) "
		sleep 10
	done
}

Background_color() {
	if [ "$Battery_capacity" -le 15 ] && \
		[ "$Battery_status" = "Discharging" ]; then
			echo "#ff0000"
		else
			echo "$(xgetres color0)"
	fi
}

Output | lemonbar \
	-u 2 \
	-U "$(xgetres color1)" \
	-f "$(xgetres font)" \
	-B "$(Background_color)" \
	-F "$(xgetres foreground)"
