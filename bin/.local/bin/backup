#!/bin/sh

bkpdir="backups"
rclonermt="Google-Drive-Personal"

localfile="$(date +%F).tar.gz"
rmtfile="backups.gpg"
sumfile="checksums.md5"

pkglist="$HOME/.local/installed-packages"
ignorelist="$HOME/.local/backups-ignore"

[ "${PWD##*/}" != "$bkpdir" ] && { echo "Wrong directory"; exit 1 ;}

pacman -Qqe > "$pkglist"

tar -cvzX "$ignorelist" "$HOME" |
	gpg -c |
	tee "$localfile.gpg" |
	rclone rcat "$rclonermt:$rmtfile"

md5sum "$localfile.gpg" >> "$sumfile"
